<%@page import="addrbook.AddrBookVO"%>
<%@page import="java.util.List"%>
<%@page import="addrbook.AddrBookDAO"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<% 
	//post 방식일 때 한글 깨짐을 방지
	request.setCharacterEncoding("utf-8");
%>
<!-- 주소록 작성에서 변수들을 가져오기 위해 정의한 유스빈과 setProperty
	이거를 쓰면 하나하나 변수들을 request.getParameter로 정의하지 않아도 변수들을 가져올 수 있음
	다만 VO(TO) 클래스의 변수들과 이름이 같아야됨-->
<jsp:useBean id="ab" class="addrbook.AddrBookVO"></jsp:useBean>
<jsp:setProperty property="*" name="ab"/>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<%
	//client의 요구(action 참조)에 따라 처리한다.
	String action = request.getParameter("action");  // action(insert or update or delete or list)을 가져오기
	System.out.println("action=" + action);
	String forwardPage = "addrbook_list.jsp";
	AddrBookDAO dao = new AddrBookDAO(); //dao 메서드를 사용하기 위한 객체 생성
	if("insert".equals(action)){
		dao.insertDB(ab); //객체를 통해 메서드 실행 / ab는 위의 유즈빈으로 가져온 파라미터들
		response.sendRedirect("addrbook_control.jsp?action=list"); // 등록되면서 목록페이지로 이동함 아래의 두개를 합친 것
		//List<AddrBookVO> list = dao.getDBList();
		//request.setAttribute("data", list);
		
		//forwardPage를 설정한다.
	} else if("edit".equals(action)){
		forwardPage = "addrbook_edit_from.jsp";
	} else if("list".equals(action)){
		List<AddrBookVO> list = dao.getDBList(); //scope request에 data라는 이름으로 리스트를 넣어두어야 한다.
		request.setAttribute("data", list); //목록이 출력될 수 있도록 한다.
		//jsp에서 꺼내서 출력한다.
	}
%>
<%-- <jsp:forward page="<%=forwardPage %>"></jsp:forward> --%>
</body>
</html>