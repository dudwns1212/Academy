package userList;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;

import javax.naming.Context;
import javax.naming.InitialContext;
import javax.sql.DataSource;

public class UserListDAO {
	static String driverClassName = "oracle.jdbc.driver.OracleDriver";
	static String connectionUrl = "jdbc:oracle:thin:@localhost:1521:xe";
	static String userName = "hr";
	static String password = "hr";


	private static Connection getConnection() throws Exception {
		Context initContext = new InitialContext();
		Context envContext = (Context) initContext.lookup("java:comp/env");
		DataSource dataSource = (DataSource) envContext.lookup("jdbc/mydb");
		return dataSource.getConnection();
	}

	// 로그인 처리 메서드: id와 pw를 받아 DB에서 사용자 정보 조회
	public UserListVO login(String id, String pw) {
	    String sql = "SELECT * FROM users WHERE id = ? AND password = ?"; 

	    try (Connection conn = getConnection();
	    		PreparedStatement psmt = conn.prepareStatement(sql)) {
	        psmt.setString(1, id);
	        psmt.setString(2, pw);

	        try (ResultSet rs = psmt.executeQuery()) {
	            if (rs.next()) {
	                UserListVO vo = new UserListVO();
	                vo.setUserId(rs.getString("id"));
	                vo.setUserPassword(rs.getString("password"));
	                vo.setUserName(rs.getString("name"));
	                vo.setUserAge(rs.getInt("age"));
	                vo.setUserMobile(rs.getString("mobile"));
	                return vo; 
	            }
	        }
	    } catch (Exception e) {
	        e.printStackTrace();
	    }
	    return null;
	}
	
	public boolean register(UserListVO user) {
        String sql = "INSERT INTO users (id, password, name, age, mobile) VALUES (?, ?, ?, ?, ?)";
        try (Connection conn = getConnection(); 
        		PreparedStatement psmt = conn.prepareStatement(sql)) {
            psmt.setString(1, user.getUserId());
            psmt.setString(2, user.getUserPassword());
            psmt.setString(3, user.getUserName());
            psmt.setInt(4, user.getUserAge());
            psmt.setString(5, user.getUserMobile());

            int result = psmt.executeUpdate();
            return result > 0;  // 1 이상이면 성공
        } catch (Exception e) {
            e.printStackTrace();
        }
        return false; // 실패 시 false 반환
    }
}
